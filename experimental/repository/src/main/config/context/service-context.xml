<?xml version='1.0' encoding='UTF-8'?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">
    <!-- Note: All beans should be prefixed ${project.artifactId} in their ID in general -->
    <!-- Exceptions: service beans (unique name) and beans with name conventions (e.g. web scripts) -->

    <bean id="jdk.scriptEngineManager" class="javax.script.ScriptEngineManager" />

    <bean id="jdk.nashornScriptEngine" factory-bean="jdk.scriptEngineManager" factory-method="getEngineByName">
        <constructor-arg>
            <value>nashorn</value>
        </constructor-arg>
    </bean>

    <bean id="javaScriptProcessor.nashornProcessor" class="${basePackage}.script.NashornScriptProcessor">
        <property name="name" value="javascript" />
        <property name="extension" value="js" />

        <property name="scriptService" ref="scriptService" />
        <property name="serviceRegistry" ref="ServiceRegistry" />
        <property name="scriptEngine" ref="jdk.nashornScriptEngine" />
        <property name="valueConverter" ref="nashorn.valueConverter.registry" />
    </bean>

    <bean id="nashorn.valueConverter.registry" class="${basePackage}.script.NashornValueConverter">
        <property name="scriptEngine" ref="jdk.nashornScriptEngine" />
        <property name="serviceRegistry" ref="ServiceRegistry" />
    </bean>

    <bean id="nashorn.valueConverter.abstract" abstract="true">
        <property name="scriptEngine" ref="jdk.nashornScriptEngine" />
        <property name="registry" ref="nashorn.valueConverter.registry" />
    </bean>

    <bean id="nashorn.valueConverter.ScriptNode" class="${basePackage}.script.adapters.ScriptNodeConverter" parent="nashorn.valueConverter.abstract">
        <property name="serviceRegistry" ref="ServiceRegistry" />
    </bean>

    <bean id="nashorn.valueConverter.SimpleRhinoSpecificBean" class="${basePackage}.script.adapters.SimpleRhinoSpecificBeanConverter" parent="nashorn.valueConverter.abstract">
        <property name="convertableClass" value="org.alfresco.repo.processor.BaseProcessorExtension" />
    </bean>
    
    <bean id="nashorn.valueConverter.Site" class="${basePackage}.script.adapters.SiteConverter" parent="nashorn.valueConverter.abstract">
        <property name="convertableClass" value="org.alfresco.repo.site.script.Site" />
        <property name="serviceRegistry" ref="ServiceRegistry" />
        <property name="siteService" ref="siteService" />
    </bean>
    
    <bean id="nashorn.valueConverter.ScriptExecutionDetails" class="${basePackage}.script.adapters.SimpleRhinoSpecificBeanConverter" parent="nashorn.valueConverter.abstract">
        <property name="convertableClass" value="org.alfresco.repo.action.script.ScriptExecutionDetails" />
    </bean>
    
    <bean id="nashorn.valueConverter.Association" class="${basePackage}.script.adapters.SimpleRhinoSpecificBeanConverter" parent="nashorn.valueConverter.abstract">
        <property name="convertableClass" value="org.alfresco.repo.jscript.Association" />
    </bean>
    
    <bean id="nashorn.valueConverter.ChildAssociation" class="${basePackage}.script.adapters.SimpleRhinoSpecificBeanConverter" parent="nashorn.valueConverter.abstract">
        <property name="convertableClass" value="org.alfresco.repo.jscript.ChildAssociation" />
    </bean>
    
    <bean id="nashorn.valueConverter.ScriptVersion" class="${basePackage}.script.adapters.SimpleRhinoSpecificBeanConverter" parent="nashorn.valueConverter.abstract">
        <property name="convertableClass" value="org.alfresco.repo.jscript.ScriptVersion" />
    </bean>
    
    <bean id="nashorn.valueConverter.ScriptGroup" class="${basePackage}.script.adapters.SimpleRhinoSpecificBeanConverter" parent="nashorn.valueConverter.abstract">
        <property name="convertableClass" value="org.alfresco.repo.security.authority.script.ScriptGroup" />
    </bean>
    
    <bean id="nashorn.valueConverter.ScriptUser" class="${basePackage}.script.adapters.SimpleRhinoSpecificBeanConverter" parent="nashorn.valueConverter.abstract">
        <property name="convertableClass" value="org.alfresco.repo.security.authority.script.ScriptUser" />
    </bean>
    
    <bean id="nashorn.valueConverter.ActivitiScriptBase" class="${basePackage}.script.adapters.SimpleRhinoSpecificBeanConverter" parent="nashorn.valueConverter.abstract">
        <property name="convertableClass" value="org.alfresco.repo.workflow.activiti.script.ActivitiScriptBase" />
    </bean>

    <bean id="javaScriptProcessor.nashornProcessor.scriptImportFunction" class="org.nabucco.alfresco.enhScriptEnv.experimental.repo.script.functions.NashornImportScriptFunction">
        <property name="scriptProcessor" ref="javaScriptProcessor.nashornProcessor" />
        <property name="scriptEngine" ref="jdk.nashornScriptEngine" />
        <property name="valueConverter" ref="nashorn.valueConverter.registry" />
        <property name="locatorRegistry" ref="javaScriptProcessor.scriptLocatorRegistry" />
    </bean>

    <bean id="javaScriptProcessor.nashornProcessor.logFunction" class="org.nabucco.alfresco.enhScriptEnv.experimental.repo.script.functions.NashornLogFunction">
        <property name="scriptProcessor" ref="javaScriptProcessor.nashornProcessor" />
        <property name="scriptEngine" ref="jdk.nashornScriptEngine" />
        <property name="valueConverter" ref="nashorn.valueConverter.registry" />
        <property name="defaultLoggerPrefix" value="org.alfresco.repo.jscript.executions" />
    </bean>

</beans>
