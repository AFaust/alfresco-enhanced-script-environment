<?xml version='1.0' encoding='UTF-8'?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">
    <!-- Note: All beans should be prefixed ${project.artifactId} in their ID in gerneral -->
    <!-- Exceptions: service beans (unique name) and beans with name conventions (e.g. web scripts) -->

    <bean id="javaScriptProcessor" class="${basePackage}.script.EnhancedRhinoScriptProcessor">
        <property name="name" value="javascript" />
        <property name="extension" value="js" />
        <property name="compileScripts" value="true" />
        <property name="shareScopes" value="true" />

        <property name="scriptService" ref="scriptService" />

        <property name="serviceRegistry" ref="ServiceRegistry" />
    </bean>

    <bean id="javaScriptProcessor.scriptImportFunction" class="org.nabucco.alfresco.enhScriptEnv.common.script.ImportScriptFunction">
        <property name="scriptProcessor" ref="javaScriptProcessor" />
        <property name="valueConverter">
            <bean class="${basePackage}.script.RepositoryValueConverterAdapter" />
        </property>
    </bean>
    
    <bean id="javaScriptProcessor.scriptLogger" class="org.nabucco.alfresco.enhScriptEnv.common.script.LogFunction">
        <property name="scriptProcessor" ref="javaScriptProcessor" />
        <property name="legacyLoggerName" value="org.alfresco.repo.jscript.ScriptLogger" />
        <property name="defaultLoggerPrefix" value="org.alfresco.repo.jscript.executions" />
    </bean>

    <bean id="baseScriptLocator" abstract="true">
        <property name="scriptLocatorRegistry" ref="javaScriptProcessor.scriptImportFunction" />
    </bean>

    <bean id="legacyNamePathScriptLocator" class="${basePackage}.script.LegacyNamePathScriptLocator" parent="baseScriptLocator">
        <property name="name" value="legacyNamePath" />
        <property name="serviceRegistry" ref="ServiceRegistry" />
        <property name="namespaceService" ref="NamespaceService" />
        <property name="nodeService" ref="NodeService" />
        <property name="fileFolderService" ref="FileFolderService" />
        <property name="searchService" ref="SearchService" />
        <property name="contentService" ref="ContentService" />
        <property name="storeRef" value="${spaces.store}" />
        <property name="storePath" value="${spaces.company_home.childname}" />
    </bean>

    <bean id="xPathScriptLocator" class="${basePackage}.script.XPathScriptLocator" parent="baseScriptLocator">
        <property name="name" value="xpath" />
        <property name="serviceRegistry" ref="ServiceRegistry" />
        <property name="namespaceService" ref="NamespaceService" />
        <property name="nodeService" ref="NodeService" />
        <property name="searchService" ref="SearchService" />
        <property name="contentService" ref="ContentService" />
        <property name="defaultStoreRef" value="${spaces.store}" />
    </bean>

    <bean id="classpathScriptLocator" class="${basePackage}.script.ClasspathScriptLocator" parent="baseScriptLocator">
        <property name="name" value="classpath" />
    </bean>
</beans>
